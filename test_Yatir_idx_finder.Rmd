---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.3.2
  kernelspec:
    display_name: wrfhv_github
    language: python
    name: wrfhv_github
---

```{python}
from adjust_WRF_inputs import get_yatir_idx
import surface_panels as sp
import xarray as xr
import hvplot.xarray
```

```{python}
datafile = os.path.join('/', 'global', 'cscratch1', 'sd', 'twhilton', 
                        'WRFv4.1_Experiments', 
                        'WRFv4.1_yatir_2015Aug_yatirparams_NCEPFNL_NOAHMP_ndom3_wetsoil', 
                        'WRFV4', 'run', 'met_em.d03.2015-08-15_00:00:00.nc')
varname = 'SM000010'
ds = get_yatir_idx(datafile, varname)
```

```{python}
ds['idx_yatir'].hvplot.quadmesh()
```

```{python}
for v in ['idx_yatir', 'SM000010', 'PRES']:
    print('{var}: {shp}, {dims}'.format(var=v, shp=ds[v].shape, dims=ds[v].dims))
idxb, presb = xr.broadcast(ds['idx_yatir'], ds['PRES'])
print('idxb: ', idxb.dims)
print('varb: ', presb.dims)
idxb.transpose('Time', 'num_metgrid_levels', 'south_north', 'west_east')
idx = idxb.transpose(*ds['PRES'].dims)
ds['PRES'].values[idx.values].shape
```

```{python}
ds['PRES'].values[idx.values] = -9999
ds['PRES'].sel(Time=0)
sp.quadmesh_compare_vertical_var(ds=ds, varname='PRES')
```
